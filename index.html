<h1>Event stream</h1>
<p id="desc"></p>
<ul id="list"></ul>

<script>
    function log(message) {
        const newElement = document.createElement("li");
        const eventList = document.getElementById("list");

        newElement.textContent = message;
        eventList.appendChild(newElement);
    }

    const url = new URL(location.href);
    const orderId = url.searchParams.get('orderId');
    if (orderId) {
        const evtSource = new EventSource("/events?orderId=" + orderId);
        evtSource.onmessage = (event) => {
            log(event.data);
        };

        evtSource.onerror = (err) => {
            console.error('event source error', err);
            log('event source error: ' + err.message);
        }

        evtSource.onopen = (ev) => {
            console.log('event source open', ev);
            log('event source open');
        }

        document.getElementById('desc').innerText = 'Listening on updates to order ' + orderId;
    }
    else 
        document.getElementById('desc').innerText = 'orderId query param missing';
</script>